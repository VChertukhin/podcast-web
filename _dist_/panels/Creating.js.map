{"version":3,"sources":["Creating.tsx"],"names":["React","Button","Checkbox","Div","FixedLayout","FormLayout","Input","PanelHeader","PanelHeaderBack","Placeholder","Separator","Textarea","File","SimpleCell","Caption","ActionSheet","ActionSheetItem","Icon24Chevron","Icon28PodcastOutline","Icon56GalleryOutline","descriptionPodcastAccess","namePodcastAccess","CoverLoader","timeFormat","Creating","Component","constructor","props","podcast","newPodcast","Object","assign","state","setState","input","target","files","originalAudioName","name","reader","FileReader","onload","e","audio","document","createElement","result","src","onloadedmetadata","setPodcast","originalDuration","duration","context","window","AudioContext","source","createMediaElementSource","audioComponent","audioSource","audioFile","readAsDataURL","openAccess","bind","change","isValid","image","description","every","setPopout","createRef","access","render","setPanel","goBack","updatePodcast","value","cursor","color","margin","padding","explicitContent","checked","notExport","trailer","marginTop","paddingTop","paddingBottom","height"],"mappings":"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","sourcesContent":["import React, { ChangeEvent } from 'react';\nimport {\n  Button,\n  Checkbox,\n  Div,\n  FixedLayout,\n  FormLayout,\n  Input,\n  PanelHeader,\n  PanelHeaderBack,\n  Placeholder,\n  Separator,\n  Textarea,\n  File,\n  SimpleCell,\n  Caption,\n  ActionSheet,\n  ActionSheetItem,\n} from '@vkontakte/vkui';\nimport {\n  Icon24Chevron,\n  Icon28PodcastOutline,\n  Icon56GalleryOutline,\n} from '@vkontakte/icons';\nimport { descriptionPodcastAccess, namePodcastAccess, Podcast } from '../types';\nimport CoverLoader from '../components/CoverLoader/CoverLoader';\nimport { timeFormat } from '../lib';\n\ninterface CreatingState {\n  podcast: Podcast;\n}\n\nexport interface CreatingProps {\n  // setView: (view: string, name?: string) => void;\n  setPanel: (name: string) => void;\n  setPopout: (popout?: React.ReactNode) => void;\n  goBack: () => void;\n\n  podcast: Podcast;\n  updatePodcast: (p: Podcast) => void;\n}\n\nexport class Creating extends React.Component<CreatingProps, CreatingState> {\n  constructor(props: CreatingProps) {\n    super(props);\n\n    this.state = {\n      podcast: props.podcast,\n    };\n\n    this.openAccess = this.openAccess.bind(this);\n    this.change = this.change.bind(this);\n  }\n\n  get isValid() {\n    const { podcast } = this.state;\n    return [\n      podcast.image,\n      podcast.name,\n      podcast.description,\n      podcast.audioSource,\n    ].every((e) => e);\n  }\n\n  setPodcast = (podcast: Partial<Podcast>): void => {\n    const newPodcast = Object.assign({}, this.state.podcast, podcast);\n    this.setState({ podcast: newPodcast });\n  };\n\n  change = (input: ChangeEvent<HTMLInputElement>) => {\n    if (input.target.files && input.target.files[0]) {\n      const originalAudioName = input.target.files[0].name;\n\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        const audio = document.createElement('audio');\n        if (e.target && typeof e.target.result === 'string') {\n          audio.src = e.target.result;\n          audio.onloadedmetadata = () => {\n            this.setPodcast({ originalDuration: audio.duration });\n          };\n          const context = new window.AudioContext();\n          const source = context.createMediaElementSource(audio);\n          this.setPodcast({\n            audioComponent: audio,\n            audioSource: source,\n            originalAudioName: originalAudioName,\n          });\n        }\n      };\n\n      const audioFile = input.target.files[0];\n      reader.readAsDataURL(audioFile);\n      this.setPodcast({ audioFile });\n    }\n  };\n\n  openAccess() {\n    this.props.setPopout(\n      <ActionSheet\n        onClose={() => this.props.setPopout(null)}\n        iosCloseItem={\n          <ActionSheetItem autoclose mode=\"cancel\">\n            Отменить\n          </ActionSheetItem>\n        }\n        // @ts-ignore\n        toggleRef={React.createRef()}\n      >\n        <ActionSheetItem\n          autoclose\n          onClick={() => this.setPodcast({ access: 'all' })}\n        >\n          {namePodcastAccess['all']}\n        </ActionSheetItem>\n        <ActionSheetItem\n          autoclose\n          onClick={() => this.setPodcast({ access: 'admins-only' })}\n        >\n          {namePodcastAccess['admins-only']}\n        </ActionSheetItem>\n      </ActionSheet>,\n    );\n  }\n\n  render(): JSX.Element {\n    const { setPanel, goBack, updatePodcast } = this.props;\n    const { podcast } = this.state;\n\n    return (\n      <>\n        <PanelHeader left={<PanelHeaderBack onClick={() => goBack()} />}>\n          Новый подкаст\n        </PanelHeader>\n        <FormLayout>\n          <FormLayout className=\"FormLayoutRow\">\n            <CoverLoader\n              image={podcast.image}\n              onLoadImage={(image) => this.setPodcast({ image: image })}\n              before={<Icon56GalleryOutline width={32} height={32} />}\n            />\n            <Input\n              top=\"Название\"\n              placeholder=\"Введите название подкаста\"\n              value={podcast.name}\n              onChange={(e) => this.setPodcast({ name: e.target.value })}\n            />\n          </FormLayout>\n          <Textarea\n            top=\"Описание подкаста\"\n            placeholder=\"\"\n            value={podcast.description}\n            onChange={(e) => this.setPodcast({ description: e.target.value })}\n          />\n        </FormLayout>\n        {podcast.audioSource ? (\n          <>\n            <label>\n              <SimpleCell\n                style={{ cursor: 'pointer' }}\n                disabled\n                before={\n                  <div className=\"PodcastIcon\">\n                    <Icon28PodcastOutline />\n                  </div>\n                }\n                after={\n                  <div style={{ color: 'var(--text_secondary)' }}>\n                    {timeFormat(podcast.originalDuration)}\n                  </div>\n                }\n              >\n                {podcast.originalAudioName}\n              </SimpleCell>\n              <input\n                className=\"LoadFile\"\n                type=\"file\"\n                accept=\"audio/*\"\n                onChange={this.change}\n              />\n            </label>\n            <Div>\n              <Caption\n                level=\"1\"\n                weight=\"regular\"\n                style={{ color: 'var(--text_secondary)' }}\n              >\n                Вы можете добавить таймкоды и скорректировать подкаст в режиме\n                редактирования\n              </Caption>\n            </Div>\n            <Div>\n              <Button\n                stretched\n                size=\"l\"\n                mode=\"outline\"\n                onClick={() => {\n                  updatePodcast(podcast);\n                  setPanel('edit');\n                }}\n              >\n                Редактировать аудиозапись\n              </Button>\n            </Div>\n          </>\n        ) : (\n          <Placeholder\n            header=\"Загрузите ваш подкаст\"\n            action={\n              <File\n                controlSize=\"m\"\n                mode=\"outline\"\n                accept=\"audio/*\"\n                onChange={this.change}\n              >\n                Загрузить файл\n              </File>\n            }\n          >\n            Выберите готовый аудиофайл из\n            <br />\n            вашего телефона и добавьте его\n          </Placeholder>\n        )}\n        <Separator />\n        <FormLayout>\n          <Checkbox\n            style={{ margin: '-12px 0px', padding: '12px 0px' }}\n            checked={podcast.explicitContent}\n            onChange={(e) =>\n              this.setPodcast({ explicitContent: e.target.checked })\n            }\n          >\n            Ненормативный контент\n          </Checkbox>\n          <Checkbox\n            style={{ margin: '-12px 0px', padding: '12px 0px' }}\n            checked={podcast.notExport}\n            onChange={(e) => this.setPodcast({ notExport: e.target.checked })}\n          >\n            Исключить эпизод из экспорта\n          </Checkbox>\n          <Checkbox\n            style={{ margin: '-12px 0px', padding: '12px 0px' }}\n            checked={podcast.trailer}\n            onChange={(e) => this.setPodcast({ trailer: e.target.checked })}\n          >\n            Трейлер подкаста\n          </Checkbox>\n        </FormLayout>\n        <SimpleCell\n          style={{ marginTop: 14 }}\n          after={<Icon24Chevron />}\n          description={namePodcastAccess[podcast.access]}\n          onClick={this.openAccess}\n        >\n          Кому доступен данный подкаст\n        </SimpleCell>\n        <Div\n          style={{\n            paddingTop: 4,\n            paddingBottom: 24,\n            color: 'var(--icon_tertiary)',\n          }}\n        >\n          <Caption level=\"1\" weight=\"regular\">\n            {descriptionPodcastAccess[podcast.access]}\n          </Caption>\n        </Div>\n        <div style={{ height: 68 }} />\n        <FixedLayout filled vertical=\"bottom\">\n          <Div>\n            <Button\n              stretched\n              size=\"l\"\n              disabled={!this.isValid}\n              onClick={() => {\n                updatePodcast(podcast);\n                setPanel('preview');\n              }}\n            >\n              Далее\n            </Button>\n          </Div>\n        </FixedLayout>\n      </>\n    );\n  }\n}\n"]}