{"version":3,"sources":["App.tsx"],"names":["React","Panel","Root","View","Main","defaultPodcast","Creating","Preview","Edit","MusicChoose","App","Component","constructor","props","state","scheme","activeView","activePanel","main","popout","history","view","panel","podcast","podcastDone","setView","bind","setPanel","setPopout","goBack","componentDidMount","vkAPI","onUpdateConfig","data","schemeAttribute","document","createAttribute","value","setState","body","attributes","setNamedItem","initApp","name","newHistory","pop","length","p","render","audio","chosenMusic"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Panel, Root, View } from '@vkontakte/vkui';\nimport type {\n  AppearanceSchemeType,\n  UpdateConfigData,\n} from '@vkontakte/vk-bridge';\nimport type { VKMiniAppAPI } from '@vkontakte/vk-mini-apps-api';\nimport { Main } from './panels/Main';\nimport { defaultPodcast, Podcast, Audio } from './types';\nimport { Creating } from './panels/Creating';\nimport { Preview } from './panels/Preview';\nimport { Edit } from './panels/Edit';\nimport { MusicChoose } from './panels/MusicChoose';\n\ninterface AppState {\n  scheme: AppearanceSchemeType;\n  activeView: string;\n  activePanel: { [id: string]: string };\n  popout?: React.ReactNode;\n  history: Array<{ view: string; panel: string }>;\n\n  podcast: Podcast;\n  audio?: MediaElementAudioSourceNode;\n  podcastDone: boolean;\n\n  chosenMusic?: Audio;\n}\n\nexport interface AppProps {\n  vkAPI: VKMiniAppAPI;\n}\n\nexport class App extends React.Component<AppProps, AppState> {\n  constructor(props: AppProps) {\n    super(props);\n\n    this.state = {\n      scheme: 'bright_light',\n      activeView: 'main',\n      activePanel: { main: 'main' },\n      popout: null,\n      history: [{ view: 'main', panel: 'main' }],\n\n      podcast: defaultPodcast,\n      podcastDone: false,\n    };\n\n    this.setView = this.setView.bind(this);\n    this.setPanel = this.setPanel.bind(this);\n    this.setPopout = this.setPopout.bind(this);\n    this.goBack = this.goBack.bind(this);\n  }\n\n  componentDidMount(): void {\n    const { vkAPI } = this.props;\n\n    vkAPI.onUpdateConfig((data: UpdateConfigData) => {\n      const schemeAttribute = document.createAttribute('scheme');\n      schemeAttribute.value = data.scheme ? data.scheme : 'client_light';\n      this.setState({ scheme: data.scheme });\n      document.body.attributes.setNamedItem(schemeAttribute);\n    });\n\n    vkAPI.initApp();\n  }\n\n  setView(view: string, name = 'main'): void {\n    const panel = { ...this.state.activePanel };\n    panel[view] = name;\n\n    const newHistory = [...this.state.history, { view: view, panel: name }];\n\n    this.setState({\n      activeView: view,\n      activePanel: panel,\n      history: newHistory,\n    });\n  }\n\n  setPanel(name: string): void {\n    const panel = { ...this.state.activePanel };\n    panel[this.state.activeView] = name;\n\n    const newHistory = [\n      ...this.state.history,\n      { view: this.state.activeView, panel: name },\n    ];\n\n    this.setState({ activePanel: panel, history: newHistory });\n  }\n\n  setPopout(popout: React.ReactNode): void {\n    this.setState({ popout: popout });\n  }\n\n  goBack(): void {\n    const newHistory = [...this.state.history];\n    newHistory.pop();\n    const { view, panel } = newHistory[newHistory.length - 1];\n\n    const p = { ...this.state.activePanel };\n    p[view] = panel;\n\n    this.setState({\n      activeView: view,\n      activePanel: p,\n      history: newHistory,\n    });\n  }\n\n  render(): JSX.Element {\n    const {\n      activeView,\n      activePanel,\n      popout,\n      podcast,\n      podcastDone,\n    } = this.state;\n\n    return (\n      <Root activeView={activeView} popout={popout}>\n        <View id=\"main\" activePanel={activePanel['main']}>\n          <Panel id=\"main\">\n            <Main setPanel={this.setPanel} podcastDone={podcastDone} />\n          </Panel>\n          <Panel id=\"creating\">\n            <Creating\n              setPanel={this.setPanel}\n              setPopout={this.setPopout}\n              goBack={this.goBack}\n              podcast={podcast}\n              updatePodcast={(p) => {\n                this.setState({ podcast: p });\n              }}\n            />\n          </Panel>\n          <Panel id=\"edit\">\n            <Edit\n              setPanel={this.setPanel}\n              goBack={this.goBack}\n              podcast={podcast}\n              updatePodcast={(p) => {\n                this.setState({ podcast: p });\n              }}\n            />\n          </Panel>\n          <Panel id=\"music-choose\">\n            <MusicChoose\n              choseAudio={(audio: Audio) => {\n                this.setState({ chosenMusic: audio });\n                this.goBack();\n              }}\n              goBack={this.goBack}\n            />\n          </Panel>\n          <Panel id=\"preview\">\n            <Preview\n              setPanel={this.setPanel}\n              goBack={this.goBack}\n              podcast={podcast}\n              publishPodcast={() => {\n                this.setPanel('main');\n                this.setState({\n                  podcast: defaultPodcast,\n                  podcastDone: true,\n                  history: [{ view: 'main', panel: 'main' }],\n                });\n              }}\n            />\n          </Panel>\n        </View>\n      </Root>\n    );\n  }\n}\n"]}